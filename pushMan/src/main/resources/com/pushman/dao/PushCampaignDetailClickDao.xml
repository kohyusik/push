<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.pushman.dao.PushCampaignDetailClickDao">

	<resultMap type="PushCampaignDetailClickVo" id="PushCampaignDetailClickVoMap">
		<id 	column="click_id" 		  property="click_id" />
		<result column="tb_click_id"  	  property="tb_click_id" />
		<result column="link_seq" 	  	  property="link_seq" />
		<result column="link" 	 		  property="link" />
		<result column="msg_push_type"    property="msg_push_type" />
		<result column="click_cnt" 	  	  property="click_cnt" />
		<result column="reg_date" 	  	  property="reg_date" />
		<result column="upt_date"  		  property="upt_date" />
		<result column="camp_id"  	  	  property="camp_id" />
	</resultMap>

	<select id="selectList" parameterType="map" resultMap="PushCampaignDetailClickVoMap">
		SELECT click_id, tb_click_id, link_seq, link, msg_push_type, click_cnt, 
			   reg_date, upt_date, camp_id
		FROM PUSH_CAMPAIGN_DETAIL_CLICK
	</select>
	
	<select id="selectListByCamp" parameterType="map" resultType="map">
		SELECT cd_id, b.reg_date, reqUid, rtn_type, res_cd, mobile, camp_id, push_log_id 
		FROM PUSH_CAMPAIGN_DETAIL A JOIN APP_USER B ON A.user_id = B.user_id
		WHERE camp_id=${camp_id}
	</select>
	
	<insert id="insert" parameterType="PushCampaignDetailClickVo" keyColumn="cd_id"
		keyProperty="cd_id" useGeneratedKeys="true">
		INSERT INTO PUSH_CAMPAIGN_DETAIL
			(reg_date, reqUid, rtn_type, res_cd, user_id, camp_id)
		VALUES 
			(SYSDATE(), '${reqUid}', null, null, ${user_id}, ${camp_id})
	</insert>
	
	<select id="selectListLogIsNull" resultMap="PushCampaignDetailClickVoMap">
		SELECT click_id, tb_click_id, link_seq, link, msg_push_type, click_cnt, 
			   reg_date, upt_date, camp_id
		FROM PUSH_CAMPAIGN_DETAIL
		WHERE push_log_id IS NULL
	</select>
	
	<select id="getMaxLogId" resultType="int">
		SELECT MAX(click_id)
		FROM PUSH_CAMPAIGN_DETAIL_CLICK
	</select>

	<update id="updatePushLog" parameterType="PushCampaignDetailVo" keyColumn="cd_id"
		keyProperty="cd_id" useGeneratedKeys="true">
		UPDATE PUSH_CAMPAIGN_DETAIL 
		SET reqUid='${reqUid}', rtn_type='${rtn_type}', res_cd='${res_cd}', 
			push_log_id='${push_log_id}'
		WHERE cd_id=#{cd_id}
	</update>
	
	<insert id="insertLog" parameterType="PushCampaignDetailVo" keyColumn="cd_id"
		keyProperty="cd_id" useGeneratedKeys="true">
		INSERT INTO PUSH_CAMPAIGN_DETAIL
			(reg_date, reqUid, rtn_type, res_cd, user_id, camp_id, push_log_id)
		VALUES 
			(SYSDATE(), '${reqUid}', '${rtn_type}', '${res_cd}', ${user_id}, 
			 ${camp_id}, ${push_log_id})
	</insert>
	
	
</mapper>